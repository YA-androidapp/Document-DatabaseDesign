# 正規化

「1事実1カ所（One fact in one place）を目指して、テーブルの整合性を保ったまま、テーブルの冗長性を排除すること。

---

# 正規形

| 名称                       | 特徴                                                             |
| -------------------------- | ---------------------------------------------------------------- |
| （非正規形）               | 正規化する前の状態                                               |
|                            |                                                                  |
| 第1正規形（1NF）           | キーを設定する                                                   |
|                            | テーブルの繰り返しグループ（明細）を別のテーブルに分離する       |
|                            | 導出項目を削除する                                               |
|                            |                                                                  |
| 第2正規形（2NF）           | 複合キーのうちの一部にのみ従属している属性を別テーブルに分離する |
|                            | （部分関数従属性をなくし完全関数従属にする）                     |
|                            |                                                                  |
| 第3正規形（3NF）           | 非キー属性間の関係従属性を取り除く                               |
|                            | （推移関数従属性をなくす）                                       |
|                            |                                                                  |
| ボイスコッド正規形（BCNF） | 非キー属性からキー属性への関数従属性を取り除く                   |
|                            |                                                                  |

第4正規形以降は、3つ以上のエンティティ間でリレーションを張る場合が対象。

| 名称                   | 特徴                                                                                                                                                    |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 第4正規形（4NF）       | 対称性のある多値従属性「A→→B｜C」を「A→→B」「A→→C」という2つの多値従属性に分解する                                                                      |
|                        |                                                                                                                                                         |
| 第5正規形（5NF／PJNF） | 非キー属性がなく、キー属性が3つ以上の複合キーになっているテーブルで、結合従属性を保つ（分解したテーブルの自然結合で元のテーブルに戻せる）ように分解する |
|                        |                                                                                                                                                         |

# 非正規形の問題点（更新時異状）

## 事前登録不能（登録）

一度も注文されたことがない商品の情報を管理することができない。

## 重複更新（更新）

商品の情報を（商品名などの）1項目だけ更新する場合でも、（受注テーブルの）情報が格納されているすべての行を更新しなければならない。

## 関係喪失（削除）

ある商品を含む注文が1件もなくなってしまうと、商品の情報を管理できなくなってしまう。

# 正規化の手順

非正規形の「受注」テーブルを例に挙げる。

- 受注

| 受注番号 | 受注日     | 商品名                         | 単価                     | 数量            | 金額                     | 消費税額 | 合計金額 | 顧客コード | 顧客名   | 住所                            | 電話番号   | 支払方法   |
| -------- | ---------- | ------------------------------ | ------------------------ | --------------- | ------------------------ | -------- | -------- | ---------- | -------- | ------------------------------- | ---------- | ---------- |
| 12300045 | 2023/12/01 | 丸丸丸 <br> 野野野 <br> 由由由 | 1200 <br> 1800 <br> 2600 | 3 <br> 1 <br> 1 | 3600 <br> 1800 <br> 2600 | 800      | 8800     | 5430000078 | 鹿野真彩 | 佐賀県東松浦郡玄海町中通4-18-13 | 0952351994 | 銀行振込   |
| 12300046 | 2023/12/02 | 丸丸丸                         | 1200                     | 5               | 6000                     | 600      | 6600     | 5430000079 | 木田翠   | 岩手県滝沢市大沢弥作畑4-6-12    | 0190529660 | コンビニ払 |
|          |            |                                |                          |                 |                          |          |          |            |          |                                 |            |            |

## 第1正規形

### 受注テーブルから導出項目を削除

- 受注

| 受注番号 | 受注日     | 商品名                         | 単価                     | 数量            | 顧客コード | 顧客名   | 住所                            | 電話番号   | 支払方法   |
| -------- | ---------- | ------------------------------ | ------------------------ | --------------- | ---------- | -------- | ------------------------------- | ---------- | ---------- |
| 12300045 | 2023/12/01 | 丸丸丸 <br> 野野野 <br> 由由由 | 1200 <br> 1800 <br> 2600 | 3 <br> 1 <br> 1 | 5430000078 | 鹿野真彩 | 佐賀県東松浦郡玄海町中通4-18-13 | 0952351994 | 銀行振込   |
| 12300046 | 2023/12/02 | 丸丸丸                         | 1200                     | 5               | 5430000079 | 木田翠   | 岩手県滝沢市大沢弥作畑4-6-12    | 0190529660 | コンビニ払 |
|          |            |                                |                          |                 |            |          |                                 |            |            |

### キーを設定

- 受注

| 受注番号 | 受注日     | 商品コード                                 | 商品名                         | 単価                     | 数量            | 顧客コード | 顧客名   | 住所                            | 電話番号   | 支払方法   |
| -------- | ---------- | ------------------------------------------ | ------------------------------ | ------------------------ | --------------- | ---------- | -------- | ------------------------------- | ---------- | ---------- |
| 12300045 | 2023/12/01 | 9870000051 <br> 9870000068 <br> 9870000040 | 丸丸丸 <br> 野野野 <br> 由由由 | 1200 <br> 1800 <br> 2600 | 3 <br> 1 <br> 1 | 5430000078 | 鹿野真彩 | 佐賀県東松浦郡玄海町中通4-18-13 | 0952351994 | 銀行振込   |
| 12300046 | 2023/12/02 | 9870000051                                 | 丸丸丸                         | 1200                     | 5               | 5430000079 | 木田翠   | 岩手県滝沢市大沢弥作畑4-6-12    | 0190529660 | コンビニ払 |
|          |            |                                            |                                |                          |                 |            |          |                                 |            |            |

### 受注テーブルの繰り返し項目を別テーブルに分離

- 受注

| 受注番号 | 受注日     | 顧客コード | 顧客名   | 住所                            | 電話番号   | 支払方法   |
| -------- | ---------- | ---------- | -------- | ------------------------------- | ---------- | ---------- |
| 12300045 | 2023/12/01 | 5430000078 | 鹿野真彩 | 佐賀県東松浦郡玄海町中通4-18-13 | 0952351994 | 銀行振込   |
| 12300046 | 2023/12/02 | 5430000079 | 木田翠   | 岩手県滝沢市大沢弥作畑4-6-12    | 0190529660 | コンビニ払 |
|          |            |            |          |                                 |            |            |

- 受注明細

| 受注番号 | 商品コード | 商品名 | 単価 | 数量 |
| -------- | ---------- | ------ | ---- | ---- |
| 12300045 | 9870000051 | 丸丸丸 | 1200 | 3    |
| 12300045 | 9870000068 | 野野野 | 1800 | 1    |
| 12300045 | 9870000040 | 由由由 | 2600 | 1    |
| 12300046 | 9870000051 | 丸丸丸 | 1200 | 5    |
|          |            |        |      |      |

## 第2正規形

## 第3正規形

## BCNF正規形

## 第4正規形

## 第5正規形



---

# 参考文献

- [素早く正規形を見抜く実践テクニック：データベースエンジニアへの道](https://atmarkit.itmedia.co.jp/ait/articles/0605/11/news124.html)
- [ビジネスの視点でデータを整理する](https://thinkit.co.jp/story/2010/10/14/1806)

---

Copyright (c) 2023 YA-androidapp(https://github.com/yzkn) All rights reserved.
